name: Generate Repository Tree

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  generate-tree:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Generate directory tree
      run: |
        # ØªØ«Ø¨ÙŠØª Ø£Ø¯Ø§Ø© tree Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
        if ! command -v tree &> /dev/null; then
          sudo apt-get update
          sudo apt-get install -y tree
        fi

        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù tree.txt
        > tree.txt

        # === 1. Ø¥Ø¶Ø§ÙØ© Ù‡ÙŠÙƒÙ„ Ù…Ø¬Ù„Ø¯ lib ÙÙ‚Ø· (Ø¥Ù† ÙˆÙØ¬Ø¯) ===
        if [ -d "lib" ]; then
          echo "ðŸ“ Structure of lib/" >> tree.txt
          echo "----------------------------------------" >> tree.txt
          tree -a -I '.git' --dirsfirst lib/ >> tree.txt
          echo -e "\n\n" >> tree.txt
        else
          echo "âš ï¸  Ù…Ø¬Ù„Ø¯ lib ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯." >> tree.txt
        fi

        # === 2. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ø§Ù„Ø¬Ø°Ø± ===
        echo "ðŸ“„ Essential Files in Root" >> tree.txt
        echo "----------------------------------------" >> tree.txt
        for file in pubspec.yaml README.md .gitignore analysis_options.yaml CHANGELOG.md main.dart; do
          if [ -f "$file" ]; then
            echo "ðŸ“„ $file" >> tree.txt
          fi
        done
        echo -e "\n\n" >> tree.txt

        # === 3. Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ù…Ù„ÙØ§Øª lib Ø£ÙˆÙ„Ø§Ù‹ ===
        echo "### Contents of lib/ Files ###" >> tree.txt
        echo "========================================" >> tree.txt

        if [ -d "lib" ]; then
          find lib -type f -name "*.dart" -o -name "*.yaml" | sort | while read filepath; do
            echo -e "\n\n==> $filepath <==\n" >> tree.txt
            cat "$filepath" >> tree.txt
          done
        else
          echo "lib/ directory not found." >> tree.txt
        fi

        # === 4. Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ø§Ù„Ø¬Ø°Ø± ===
        echo -e "\n\n### Contents of Root Configuration Files ###" >> tree.txt
        echo "========================================" >> tree.txt

        for file in pubspec.yaml README.md .gitignore analysis_options.yaml CHANGELOG.md; do
          if [ -f "$file" ]; then
            echo -e "\n\n==> $file <==\n" >> tree.txt
            cat "$file" >> tree.txt
          fi
        done

        # === 5. Ø¥Ø¶Ø§ÙØ© main.dart Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§ ÙÙŠ lib Ø£Ùˆ Ø¬Ø°Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ ===
        if [ -f "lib/main.dart" ]; then
          echo -e "\n\n==> lib/main.dart <==\n" >> tree.txt
          cat "lib/main.dart" >> tree.txt
        elif [ -f "main.dart" ]; then
          echo -e "\n\n==> main.dart <==\n" >> tree.txt
          cat "main.dart" >> tree.txt
        fi

    - name: Upload tree.txt as artifact
      uses: actions/upload-artifact@v4
      with:
        name: repository-tree
        path: tree.txt